<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SapFlow Probe: measure.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SapFlow Probe
   </div>
   <div id="projectbrief">A low-cost HRM probe for measuring a tree&#39;s water consumption</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('measure_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">measure.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="measure_8h_source.html">measure.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="lora_8h_source.html">lora.h</a>&quot;</code><br />
</div>
<p><a href="measure_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4077648d56901b090710a429b69fe19d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="measure_8cpp.html#a4077648d56901b090710a429b69fe19d">sample_timer</a> (struct pt *pt)</td></tr>
<tr class="memdesc:a4077648d56901b090710a429b69fe19d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Controls timing of the measurements.  <a href="measure_8cpp.html#a4077648d56901b090710a429b69fe19d">More...</a><br /></td></tr>
<tr class="separator:a4077648d56901b090710a429b69fe19d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a657b44bae6694e6e2c5477f4f2ab85a1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="measure_8cpp.html#a657b44bae6694e6e2c5477f4f2ab85a1">measure</a> (struct pt *pt)</td></tr>
<tr class="memdesc:a657b44bae6694e6e2c5477f4f2ab85a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Captures a measurement from the three probes.  <a href="measure_8cpp.html#a657b44bae6694e6e2c5477f4f2ab85a1">More...</a><br /></td></tr>
<tr class="separator:a657b44bae6694e6e2c5477f4f2ab85a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31cf8d05fcffa8f51508a9c3db637413"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="measure_8cpp.html#a31cf8d05fcffa8f51508a9c3db637413">baseline</a> (struct pt *pt)</td></tr>
<tr class="memdesc:a31cf8d05fcffa8f51508a9c3db637413"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates baseline temperature.  <a href="measure_8cpp.html#a31cf8d05fcffa8f51508a9c3db637413">More...</a><br /></td></tr>
<tr class="separator:a31cf8d05fcffa8f51508a9c3db637413"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa831fa3620094ac2be9c85d34a89051e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="measure_8cpp.html#aa831fa3620094ac2be9c85d34a89051e">delta</a> (struct pt *pt)</td></tr>
<tr class="memdesc:aa831fa3620094ac2be9c85d34a89051e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates temperature delta and sapflow.  <a href="measure_8cpp.html#aa831fa3620094ac2be9c85d34a89051e">More...</a><br /></td></tr>
<tr class="separator:aa831fa3620094ac2be9c85d34a89051e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ae5efd21d6417fda5e3f0cfccf1d1301b"><td class="memItemLeft" align="right" valign="top"><a id="ae5efd21d6417fda5e3f0cfccf1d1301b"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>maxtemp</b></td></tr>
<tr class="separator:ae5efd21d6417fda5e3f0cfccf1d1301b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a31cf8d05fcffa8f51508a9c3db637413"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31cf8d05fcffa8f51508a9c3db637413">&#9670;&nbsp;</a></span>baseline()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int baseline </td>
          <td>(</td>
          <td class="paramtype">struct pt *&#160;</td>
          <td class="paramname"><em>pt</em> = <code>&amp;<a class="el" href="measure_8h.html#a75797b818bbb902f6d65e98df6ed77f1">baseline_thd</a></code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates baseline temperature. </p>
<p>This is a protothread that averages 10 samples of data to determine the "initial" or "baseline" temperature of the tree. It should be used before the heater is turned on.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pt</td><td>A pointer to the protothread control structure. The default parameter is correct. Don't forget to initialize the control structure in <a class="el" href="sapflow__protothread_8ino.html#a4fc01d736fe50cf5b977f755b675f11d" title="One-time initialization.">setup()</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the status of the protothread (Waiting, yeilded, exited, or ended) </dd></dl>

<p class="definition">Definition at line <a class="el" href="measure_8cpp_source.html#l00065">65</a> of file <a class="el" href="measure_8cpp_source.html">measure.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;{</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  PT_BEGIN(pt);<a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  Serial.print(<span class="stringliteral">&quot;Initializing baseline thread... &quot;</span>);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="comment">// Declare persistant variable for this thread</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="comment">// Initialize the baseline (reference) temperature</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <a class="code" href="measure_8h.html#a6ae301ecb99002f1951a9781941eae54">reference</a>.<a class="code" href="structtemperature.html#a95ed2f6ae8c6927b0fcebe281b5229e5">upper</a> = 0;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <a class="code" href="measure_8h.html#a6ae301ecb99002f1951a9781941eae54">reference</a>.<a class="code" href="structtemperature.html#aaf995f56734f6afd2fa4b062a00d72ec">lower</a> = 0;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  maxtemp = -300; <span class="comment">//&lt; Any temperature should be greater than this.</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  Serial.println(<span class="stringliteral">&quot;Done&quot;</span>);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="comment">// Take an average over the first 10 seconds</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordflow">for</span>(i = 0; i &lt; 10; ++i){ <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    PT_WAIT_UNTIL(pt, <a class="code" href="measure_8h.html#a5adfa4fbf2b2c72857690502d53d4332">sample_trigger</a>); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    PT_WAIT_WHILE(pt, <a class="code" href="measure_8h.html#a5adfa4fbf2b2c72857690502d53d4332">sample_trigger</a>); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="measure_8h.html#a6ae301ecb99002f1951a9781941eae54">reference</a>.<a class="code" href="structtemperature.html#a95ed2f6ae8c6927b0fcebe281b5229e5">upper</a> += <a class="code" href="measure_8h.html#a7d17fc054558b632bff51e6b7e1448a7">latest</a>.<a class="code" href="structtemperature.html#a95ed2f6ae8c6927b0fcebe281b5229e5">upper</a>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <a class="code" href="measure_8h.html#a6ae301ecb99002f1951a9781941eae54">reference</a>.<a class="code" href="structtemperature.html#aaf995f56734f6afd2fa4b062a00d72ec">lower</a> += <a class="code" href="measure_8h.html#a7d17fc054558b632bff51e6b7e1448a7">latest</a>.<a class="code" href="structtemperature.html#aaf995f56734f6afd2fa4b062a00d72ec">lower</a>;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  }; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <a class="code" href="measure_8h.html#a6ae301ecb99002f1951a9781941eae54">reference</a>.<a class="code" href="structtemperature.html#a95ed2f6ae8c6927b0fcebe281b5229e5">upper</a> /= i;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <a class="code" href="measure_8h.html#a6ae301ecb99002f1951a9781941eae54">reference</a>.<a class="code" href="structtemperature.html#aaf995f56734f6afd2fa4b062a00d72ec">lower</a> /= i; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <a class="code" href="sd__log_8h.html#ab9da93331bae3f5268bcaf01ab44d31d">cout</a>&lt;&lt;<span class="stringliteral">&quot;Baseline: &quot;</span>&lt;&lt;<a class="code" href="measure_8h.html#a6ae301ecb99002f1951a9781941eae54">reference</a>.<a class="code" href="structtemperature.html#a95ed2f6ae8c6927b0fcebe281b5229e5">upper</a>&lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt;<a class="code" href="measure_8h.html#a6ae301ecb99002f1951a9781941eae54">reference</a>.<a class="code" href="structtemperature.html#aaf995f56734f6afd2fa4b062a00d72ec">lower</a>&lt;&lt;endl; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  PT_END(pt);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa831fa3620094ac2be9c85d34a89051e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa831fa3620094ac2be9c85d34a89051e">&#9670;&nbsp;</a></span>delta()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int delta </td>
          <td>(</td>
          <td class="paramtype">struct pt *&#160;</td>
          <td class="paramname"><em>pt</em> = <code>&amp;<a class="el" href="measure_8h.html#a8ff6579d0f5410dbe20162392e32d3a4">delta_thd</a></code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates temperature delta and sapflow. </p>
<p>This is a protothread that calculates the sap flow by averaging measurements over 40 seconds. It also calls other functions to get the weight, package the data, log to an SD card, and send the information over LoRa.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pt</td><td>A pointer to the protothread control structure. The default parameter is correct. Don't forget to initialize the control structure in <a class="el" href="sapflow__protothread_8ino.html#a4fc01d736fe50cf5b977f755b675f11d" title="One-time initialization.">setup()</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the status of the protothread (Waiting, yeilded, exited, or ended) </dd></dl>
<p>We compute sapflow using the following formula:: sapflow = k / x * log(v1 / v2) / 3600</p>
<ul>
<li>k is an empirical constant</li>
<li>x is the distance between the probes</li>
<li>v1 is temperature increase of the upper probe from its baseline temperature</li>
<li>v2 is the temperature increase of the lower probe from its baseline temperature</li>
<li>3600 is the number of seconds in an hour</li>
</ul>
<p>In order to get a smoother result, we are takng the average of this calculation over a period of 40 seconds. Burges et. al. (2001) suggests that this value should converge.</p>

<p class="definition">Definition at line <a class="el" href="measure_8cpp_source.html#l00091">91</a> of file <a class="el" href="measure_8cpp_source.html">measure.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;{</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  PT_BEGIN(pt);<a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  Serial.print(<span class="stringliteral">&quot;Initializing delta thread... &quot;</span>);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="comment">// Declare persistent variables for this thread</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">float</span> flow;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="comment">// Initialize the flow value</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  flow = 0;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  Serial.println(<span class="stringliteral">&quot;Done&quot;</span>);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="keywordflow">for</span>(i = 0; i &lt; 40; ++i ){ <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    PT_WAIT_UNTIL(pt, <a class="code" href="measure_8h.html#a5adfa4fbf2b2c72857690502d53d4332">sample_trigger</a>); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    PT_WAIT_WHILE(pt, <a class="code" href="measure_8h.html#a5adfa4fbf2b2c72857690502d53d4332">sample_trigger</a>); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">// Ratio of upper delta over lower delta</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordtype">float</span> udelt = <a class="code" href="measure_8h.html#a7d17fc054558b632bff51e6b7e1448a7">latest</a>.<a class="code" href="structtemperature.html#a95ed2f6ae8c6927b0fcebe281b5229e5">upper</a> - <a class="code" href="measure_8h.html#a6ae301ecb99002f1951a9781941eae54">reference</a>.<a class="code" href="structtemperature.html#a95ed2f6ae8c6927b0fcebe281b5229e5">upper</a>;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordtype">float</span> ldelt = <a class="code" href="measure_8h.html#a7d17fc054558b632bff51e6b7e1448a7">latest</a>.<a class="code" href="structtemperature.html#aaf995f56734f6afd2fa4b062a00d72ec">lower</a> - <a class="code" href="measure_8h.html#a6ae301ecb99002f1951a9781941eae54">reference</a>.<a class="code" href="structtemperature.html#aaf995f56734f6afd2fa4b062a00d72ec">lower</a>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="sd__log_8h.html#ab9da93331bae3f5268bcaf01ab44d31d">cout</a> &lt;&lt; <span class="stringliteral">&quot;Delta: &quot;</span> &lt;&lt; udelt &lt;&lt;<span class="stringliteral">&quot;, &quot;</span> &lt;&lt; ldelt &lt;&lt; endl; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">// Take the average before the log, since this ratio should converge</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    flow += udelt / ldelt;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  }; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <a class="code" href="sd__log_8h.html#ab9da93331bae3f5268bcaf01ab44d31d">cout</a>&lt;&lt;<span class="stringliteral">&quot;Finished measurements.&quot;</span>&lt;&lt;endl; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  flow /= i; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="comment">// Complete the rest of the equation</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  flow = log(flow) * (3600.*2e-6/7e-3); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">// Print the result</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <a class="code" href="sd__log_8h.html#ab9da93331bae3f5268bcaf01ab44d31d">cout</a>&lt;&lt;<span class="stringliteral">&quot;Flow is &quot;</span>&lt;&lt;flow&lt;&lt;endl; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">// Write the sapflow to the file.</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  ofstream sapfile = ofstream(<span class="stringliteral">&quot;demo.csv&quot;</span>, ios::out | ios::app); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="keywordtype">char</span> * time = <a class="code" href="schedule_8h.html#a4c06781bd70442b43eec7c92d3e7ea3a">rtc_ds</a>.now().text(); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <a class="code" href="sd__log_8h.html#ab9da93331bae3f5268bcaf01ab44d31d">cout</a> &lt;&lt; time &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <a class="code" href="sd__log_8h.html#ab9da93331bae3f5268bcaf01ab44d31d">cout</a> &lt;&lt; <a class="code" href="measure_8h.html#a6ae301ecb99002f1951a9781941eae54">reference</a>.<a class="code" href="structtemperature.html#a95ed2f6ae8c6927b0fcebe281b5229e5">upper</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <a class="code" href="sd__log_8h.html#ab9da93331bae3f5268bcaf01ab44d31d">cout</a> &lt;&lt; <a class="code" href="measure_8h.html#a6ae301ecb99002f1951a9781941eae54">reference</a>.<a class="code" href="structtemperature.html#aaf995f56734f6afd2fa4b062a00d72ec">lower</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <a class="code" href="sd__log_8h.html#ab9da93331bae3f5268bcaf01ab44d31d">cout</a> &lt;&lt; flow &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; endl; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  sapfile &lt;&lt; time &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>&lt;&lt; <a class="code" href="measure_8h.html#a6ae301ecb99002f1951a9781941eae54">reference</a>.<a class="code" href="structtemperature.html#a95ed2f6ae8c6927b0fcebe281b5229e5">upper</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  sapfile &lt;&lt; <a class="code" href="measure_8h.html#a6ae301ecb99002f1951a9781941eae54">reference</a>.<a class="code" href="structtemperature.html#aaf995f56734f6afd2fa4b062a00d72ec">lower</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>&lt;&lt; flow &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>&lt;&lt; endl; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  sapfile.close(); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="comment">// Send the data over LoRa</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <a class="code" href="lora_8cpp.html#a5406703a916059feeaac0ce650e6ceb7">lora_init</a>(); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <a class="code" href="lora_8cpp.html#a081e4c64303e45009a39fd81bdf5eb7f">build_msg</a>(flow, <span class="stringliteral">&quot;0&quot;</span>, <a class="code" href="measure_8h.html#a6ae301ecb99002f1951a9781941eae54">reference</a>.<a class="code" href="structtemperature.html#a95ed2f6ae8c6927b0fcebe281b5229e5">upper</a>, maxtemp); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <a class="code" href="lora_8cpp.html#a759190db192ee81162c88decd75d3a7d">send_msg</a>(); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  PT_END(pt);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a657b44bae6694e6e2c5477f4f2ab85a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a657b44bae6694e6e2c5477f4f2ab85a1">&#9670;&nbsp;</a></span>measure()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int measure </td>
          <td>(</td>
          <td class="paramtype">struct pt *&#160;</td>
          <td class="paramname"><em>pt</em> = <code>&amp;<a class="el" href="measure_8h.html#ada9fca85b63952a68f6a2158e5f8a87b">measure_thd</a></code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Captures a measurement from the three probes. </p>
<p>This is a protothread that reads the temperature from three RTD amplifiers connected to the probes in the tree. It stores the result in the global variable "latest", and logs to the SD card.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pt</td><td>A pointer to the protothread control structure. The default parameter is correct. Don't forget to initialize the control structure in <a class="el" href="sapflow__protothread_8ino.html#a4fc01d736fe50cf5b977f755b675f11d" title="One-time initialization.">setup()</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the status of the protothread (Waiting, yeilded, exited, or ended) </dd></dl>

<p class="definition">Definition at line <a class="el" href="measure_8cpp_source.html#l00022">22</a> of file <a class="el" href="measure_8cpp_source.html">measure.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;{</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  PT_BEGIN(pt);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  Serial.print(<span class="stringliteral">&quot;Initializing measurement thread... &quot;</span>);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <span class="keyword">static</span> Adafruit_MAX31865 upper_rtd = Adafruit_MAX31865(<a class="code" href="pinout_8h.html#ad3ebeb23ad60165264117c8103271e91aa58b078247ffcf6ff61798989435ad45">UPPER_CS</a>);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="keyword">static</span> Adafruit_MAX31865 lower_rtd = Adafruit_MAX31865(<a class="code" href="pinout_8h.html#ad3ebeb23ad60165264117c8103271e91a69589f542cdf78712c60ec36d147a0c2">LOWER_CS</a>);</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="keyword">static</span> Adafruit_MAX31865 heater_rtd = Adafruit_MAX31865(<a class="code" href="pinout_8h.html#ad3ebeb23ad60165264117c8103271e91a732fb526fc16be2e7fac935816f8f752">HEATER_CS</a>);</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  upper_rtd.begin(MAX31865_2WIRE);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  lower_rtd.begin(MAX31865_2WIRE);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  heater_rtd.begin(MAX31865_2WIRE);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  Serial.println(<span class="stringliteral">&quot;Done&quot;</span>);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  PT_YIELD(pt);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordflow">while</span>(1)</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  {      </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="comment">// Wait for next sample trigger</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    PT_WAIT_UNTIL(pt, <a class="code" href="measure_8h.html#a5adfa4fbf2b2c72857690502d53d4332">sample_trigger</a> );</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    PT_WAIT_WHILE(pt, <a class="code" href="measure_8h.html#a5adfa4fbf2b2c72857690502d53d4332">sample_trigger</a>);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">// Get the latest temperature</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <a class="code" href="measure_8h.html#a7d17fc054558b632bff51e6b7e1448a7">latest</a>.<a class="code" href="structtemperature.html#a95ed2f6ae8c6927b0fcebe281b5229e5">upper</a> = upper_rtd.temperature(<a class="code" href="measure_8h.html#afc5c05d720c1d630ce94867c7bed9419">Rnom</a>, <a class="code" href="measure_8h.html#a02208b322fb84b00331888e078a3f387">Rref</a>); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="measure_8h.html#a7d17fc054558b632bff51e6b7e1448a7">latest</a>.<a class="code" href="structtemperature.html#aaf995f56734f6afd2fa4b062a00d72ec">lower</a> = lower_rtd.temperature(<a class="code" href="measure_8h.html#afc5c05d720c1d630ce94867c7bed9419">Rnom</a>, <a class="code" href="measure_8h.html#a02208b322fb84b00331888e078a3f387">Rref</a>); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="measure_8h.html#a7d17fc054558b632bff51e6b7e1448a7">latest</a>.<a class="code" href="structtemperature.html#a43924fc35c8cda01bfb6fb6ae07f1a9b">heater</a> = heater_rtd.temperature(<a class="code" href="measure_8h.html#afc5c05d720c1d630ce94867c7bed9419">Rnom</a>, <a class="code" href="measure_8h.html#a02208b322fb84b00331888e078a3f387">Rref</a>); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    maxtemp = max(<a class="code" href="measure_8h.html#a7d17fc054558b632bff51e6b7e1448a7">latest</a>.<a class="code" href="structtemperature.html#a95ed2f6ae8c6927b0fcebe281b5229e5">upper</a>, maxtemp); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    maxtemp = max(<a class="code" href="measure_8h.html#a7d17fc054558b632bff51e6b7e1448a7">latest</a>.<a class="code" href="structtemperature.html#aaf995f56734f6afd2fa4b062a00d72ec">lower</a>, maxtemp); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    maxtemp = max(<a class="code" href="measure_8h.html#a7d17fc054558b632bff51e6b7e1448a7">latest</a>.<a class="code" href="structtemperature.html#a43924fc35c8cda01bfb6fb6ae07f1a9b">heater</a>, maxtemp); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    DateTime t = <a class="code" href="schedule_8h.html#a4c06781bd70442b43eec7c92d3e7ea3a">rtc_ds</a>.now(); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// Print to Serial terminal</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="sd__log_8h.html#ab9da93331bae3f5268bcaf01ab44d31d">cout</a> &lt;&lt; <span class="stringliteral">&quot;Upper: &quot;</span> &lt;&lt; <a class="code" href="measure_8h.html#a7d17fc054558b632bff51e6b7e1448a7">latest</a>.<a class="code" href="structtemperature.html#a95ed2f6ae8c6927b0fcebe281b5229e5">upper</a> &lt;&lt; <span class="stringliteral">&quot; Lower: &quot;</span>; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="sd__log_8h.html#ab9da93331bae3f5268bcaf01ab44d31d">cout</a> &lt;&lt; <a class="code" href="measure_8h.html#a7d17fc054558b632bff51e6b7e1448a7">latest</a>.<a class="code" href="structtemperature.html#aaf995f56734f6afd2fa4b062a00d72ec">lower</a> &lt;&lt; <span class="stringliteral">&quot; Heater: &quot;</span> &lt;&lt;<a class="code" href="measure_8h.html#a7d17fc054558b632bff51e6b7e1448a7">latest</a>.<a class="code" href="structtemperature.html#a43924fc35c8cda01bfb6fb6ae07f1a9b">heater</a>; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="sd__log_8h.html#ab9da93331bae3f5268bcaf01ab44d31d">cout</a> &lt;&lt; <span class="stringliteral">&quot; Time: &quot;</span> &lt;&lt; t.text() &lt;&lt; endl; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// Save calculated sapflow</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    ofstream logfile = ofstream(<span class="stringliteral">&quot;demo_log.csv&quot;</span>, </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        ios::out | ios::app ); <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    logfile &lt;&lt; t.text() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    logfile &lt;&lt; setw(6) &lt;&lt; <a class="code" href="measure_8h.html#a7d17fc054558b632bff51e6b7e1448a7">latest</a>.<a class="code" href="structtemperature.html#a95ed2f6ae8c6927b0fcebe281b5229e5">upper</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    logfile &lt;&lt; setw(6) &lt;&lt; <a class="code" href="measure_8h.html#a7d17fc054558b632bff51e6b7e1448a7">latest</a>.<a class="code" href="structtemperature.html#aaf995f56734f6afd2fa4b062a00d72ec">lower</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    logfile &lt;&lt; setw(6) &lt;&lt; <a class="code" href="measure_8h.html#a7d17fc054558b632bff51e6b7e1448a7">latest</a>.<a class="code" href="structtemperature.html#a43924fc35c8cda01bfb6fb6ae07f1a9b">heater</a> &lt;&lt; endl; <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    logfile.close();  <a class="code" href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a>();<span class="comment">//&lt; Ensure the file is closed</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  }</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  PT_END(pt);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a4077648d56901b090710a429b69fe19d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4077648d56901b090710a429b69fe19d">&#9670;&nbsp;</a></span>sample_timer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sample_timer </td>
          <td>(</td>
          <td class="paramtype">struct pt *&#160;</td>
          <td class="paramname"><em>pt</em> = <code>&amp;<a class="el" href="measure_8h.html#ac1b4a8786e0684b0f63f527522e11e5e">sample_timer_thd</a></code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Controls timing of the measurements. </p>
<p>This is a protothread that creates a pulse every second on the global variable sample_trigger in order to sychronize sample-based processing. Protothreads that sample or process sampled data can latch this signal using PT_WAIT_UNTIL(pt, sample_trigger); PT_WAIT_WHILE(pt, sample_trigger); to synchronize execution without impacting the sample frequency.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pt</td><td>A pointer to the protothread control structure. The default parameter is correct. Don't forget to initialize the control structure in <a class="el" href="sapflow__protothread_8ino.html#a4fc01d736fe50cf5b977f755b675f11d" title="One-time initialization.">setup()</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the status of the protothread (Waiting, yeilded, exited, or ended) </dd></dl>

<p class="definition">Definition at line <a class="el" href="measure_8cpp_source.html#l00008">8</a> of file <a class="el" href="measure_8cpp_source.html">measure.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;{</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  PT_BEGIN(pt);</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  Serial.println(<span class="stringliteral">&quot;Initialized timer thread&quot;</span>);</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  <span class="keywordflow">while</span>(1)</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  {</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <a class="code" href="measure_8h.html#a5adfa4fbf2b2c72857690502d53d4332">sample_trigger</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    PT_YIELD(pt); <span class="comment">//&lt; Give everyone a chance to see the trigger</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <a class="code" href="measure_8h.html#a5adfa4fbf2b2c72857690502d53d4332">sample_trigger</a> = <span class="keyword">false</span>; <span class="comment">//&lt; Clear the trigger</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    PT_TIMER_DELAY(pt,1000); <span class="comment">//&lt; Sample every 1000ms</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  }</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  PT_END(pt);</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="astructtemperature_html_a43924fc35c8cda01bfb6fb6ae07f1a9b"><div class="ttname"><a href="structtemperature.html#a43924fc35c8cda01bfb6fb6ae07f1a9b">temperature::heater</a></div><div class="ttdeci">float heater</div><div class="ttdoc">Temperature (Celcius) at the heater probe.</div><div class="ttdef"><b>Definition:</b> <a href="measure_8h_source.html#l00023">measure.h:23</a></div></div>
<div class="ttc" id="alora_8cpp_html_a759190db192ee81162c88decd75d3a7d"><div class="ttname"><a href="lora_8cpp.html#a759190db192ee81162c88decd75d3a7d">send_msg</a></div><div class="ttdeci">void send_msg(void)</div><div class="ttdoc">Sends a LoRa packet to the base station.</div><div class="ttdef"><b>Definition:</b> <a href="lora_8cpp_source.html#l00083">lora.cpp:83</a></div></div>
<div class="ttc" id="aschedule_8h_html_a4c06781bd70442b43eec7c92d3e7ea3a"><div class="ttname"><a href="schedule_8h.html#a4c06781bd70442b43eec7c92d3e7ea3a">rtc_ds</a></div><div class="ttdeci">static RTC_DS3231 rtc_ds</div><div class="ttdoc">Instance of our real-time clock.</div><div class="ttdef"><b>Definition:</b> <a href="schedule_8h_source.html#l00011">schedule.h:11</a></div></div>
<div class="ttc" id="astructtemperature_html_a95ed2f6ae8c6927b0fcebe281b5229e5"><div class="ttname"><a href="structtemperature.html#a95ed2f6ae8c6927b0fcebe281b5229e5">temperature::upper</a></div><div class="ttdeci">float upper</div><div class="ttdoc">Temperature (Celcius) at the upper probe.</div><div class="ttdef"><b>Definition:</b> <a href="measure_8h_source.html#l00021">measure.h:21</a></div></div>
<div class="ttc" id="ameasure_8h_html_a5adfa4fbf2b2c72857690502d53d4332"><div class="ttname"><a href="measure_8h.html#a5adfa4fbf2b2c72857690502d53d4332">sample_trigger</a></div><div class="ttdeci">static bool sample_trigger</div><div class="ttdoc">global flag for synchronizing live data processing. Set by sample_timer()</div><div class="ttdef"><b>Definition:</b> <a href="measure_8h_source.html#l00010">measure.h:10</a></div></div>
<div class="ttc" id="alora_8cpp_html_a5406703a916059feeaac0ce650e6ceb7"><div class="ttname"><a href="lora_8cpp.html#a5406703a916059feeaac0ce650e6ceb7">lora_init</a></div><div class="ttdeci">void lora_init(void)</div><div class="ttdoc">Initialize the LoRa radio.</div><div class="ttdef"><b>Definition:</b> <a href="lora_8cpp_source.html#l00017">lora.cpp:17</a></div></div>
<div class="ttc" id="apinout_8h_html_ad3ebeb23ad60165264117c8103271e91a732fb526fc16be2e7fac935816f8f752"><div class="ttname"><a href="pinout_8h.html#ad3ebeb23ad60165264117c8103271e91a732fb526fc16be2e7fac935816f8f752">HEATER_CS</a></div><div class="ttdeci">@ HEATER_CS</div><div class="ttdoc">Heater RTD amplifier chip select. Output.</div><div class="ttdef"><b>Definition:</b> <a href="pinout_8h_source.html#l00027">pinout.h:27</a></div></div>
<div class="ttc" id="ameasure_8h_html_a6ae301ecb99002f1951a9781941eae54"><div class="ttname"><a href="measure_8h.html#a6ae301ecb99002f1951a9781941eae54">reference</a></div><div class="ttdeci">static struct temperature reference</div><div class="ttdoc">The baseline temperature reading, computed by the baseline() protothread.</div><div class="ttdef"><b>Definition:</b> <a href="measure_8h_source.html#l00027">measure.h:27</a></div></div>
<div class="ttc" id="astructtemperature_html_aaf995f56734f6afd2fa4b062a00d72ec"><div class="ttname"><a href="structtemperature.html#aaf995f56734f6afd2fa4b062a00d72ec">temperature::lower</a></div><div class="ttdeci">float lower</div><div class="ttdoc">Temperature (Celcius) at the lower probe.</div><div class="ttdef"><b>Definition:</b> <a href="measure_8h_source.html#l00022">measure.h:22</a></div></div>
<div class="ttc" id="asd__log_8h_html_ab9da93331bae3f5268bcaf01ab44d31d"><div class="ttname"><a href="sd__log_8h.html#ab9da93331bae3f5268bcaf01ab44d31d">cout</a></div><div class="ttdeci">static ArduinoOutStream cout(Serial)</div><div class="ttdoc">Allows use of streams to print to Serial via cout.</div></div>
<div class="ttc" id="ameasure_8h_html_a02208b322fb84b00331888e078a3f387"><div class="ttname"><a href="measure_8h.html#a02208b322fb84b00331888e078a3f387">Rref</a></div><div class="ttdeci">#define Rref</div><div class="ttdoc">Nominal reference resistor in ohms.</div><div class="ttdef"><b>Definition:</b> <a href="measure_8h_source.html#l00013">measure.h:13</a></div></div>
<div class="ttc" id="adebug_8h_html_ac7ae17784db038e5769b9417c2cafdfa"><div class="ttname"><a href="debug_8h.html#ac7ae17784db038e5769b9417c2cafdfa">MARK</a></div><div class="ttdeci">#define MARK()</div><div class="ttdoc">This macro records the line number and function name.</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00072">debug.h:72</a></div></div>
<div class="ttc" id="apinout_8h_html_ad3ebeb23ad60165264117c8103271e91aa58b078247ffcf6ff61798989435ad45"><div class="ttname"><a href="pinout_8h.html#ad3ebeb23ad60165264117c8103271e91aa58b078247ffcf6ff61798989435ad45">UPPER_CS</a></div><div class="ttdeci">@ UPPER_CS</div><div class="ttdoc">Upper RTD amplifier chip select. Output.</div><div class="ttdef"><b>Definition:</b> <a href="pinout_8h_source.html#l00025">pinout.h:25</a></div></div>
<div class="ttc" id="ameasure_8h_html_afc5c05d720c1d630ce94867c7bed9419"><div class="ttname"><a href="measure_8h.html#afc5c05d720c1d630ce94867c7bed9419">Rnom</a></div><div class="ttdeci">#define Rnom</div><div class="ttdoc">Nominal RTD resistance in ohms.</div><div class="ttdef"><b>Definition:</b> <a href="measure_8h_source.html#l00012">measure.h:12</a></div></div>
<div class="ttc" id="ameasure_8h_html_a7d17fc054558b632bff51e6b7e1448a7"><div class="ttname"><a href="measure_8h.html#a7d17fc054558b632bff51e6b7e1448a7">latest</a></div><div class="ttdeci">static struct temperature latest</div><div class="ttdoc">The most recent temperature reading, measured by the measure() protothread.</div><div class="ttdef"><b>Definition:</b> <a href="measure_8h_source.html#l00026">measure.h:26</a></div></div>
<div class="ttc" id="apinout_8h_html_ad3ebeb23ad60165264117c8103271e91a69589f542cdf78712c60ec36d147a0c2"><div class="ttname"><a href="pinout_8h.html#ad3ebeb23ad60165264117c8103271e91a69589f542cdf78712c60ec36d147a0c2">LOWER_CS</a></div><div class="ttdeci">@ LOWER_CS</div><div class="ttdoc">Lower RTD amplifier chip select. Output.</div><div class="ttdef"><b>Definition:</b> <a href="pinout_8h_source.html#l00026">pinout.h:26</a></div></div>
<div class="ttc" id="alora_8cpp_html_a081e4c64303e45009a39fd81bdf5eb7f"><div class="ttname"><a href="lora_8cpp.html#a081e4c64303e45009a39fd81bdf5eb7f">build_msg</a></div><div class="ttdeci">void build_msg(float flow, char *weight, float temp, float maxtemp)</div><div class="ttdoc">Builds a JSON string to send over LoRa.</div><div class="ttdef"><b>Definition:</b> <a href="lora_8cpp_source.html#l00058">lora.cpp:58</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="measure_8cpp.html">measure.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
